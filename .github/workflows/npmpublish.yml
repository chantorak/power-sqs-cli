# This workflow will run tests using node and then publish a package to npm if the commit message has either path or minor in it.

name: Node.js Package Publisher

on:
  push:
    branches: [githubaction]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node: [ '10', '12' ]
    name: Node ${{matrix.node}}
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
        name: Setup Node
        with:
          node-version: ${{matrix.node}}
      - run: npm test

  publish-npm:
    needs: build
    if: startsWith(github.event.head_commit.message, 'release')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: test some stuff
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: |
         echo ::set-env name=commitmsg::$(git log --pretty=format:%s -1)
         echo ::set-env name=version::$(echo "no")
         echo $commitmsg
         echo $version
         echo $GITHUB_CONTEXT
         echo 
#       - uses: actions/setup-node@v1
#         with:
#           node-version: 12
#           registry-url: https://registry.npmjs.org/
#       - name: get commit message
#         run: |
#          echo ::set-env name=commitmsg::$(git log --pretty=format:%s -1)
#          echo ::set-env name=version::$(echo "no")
#       - name: show commit message
#         run : echo $commitmsg
#       - name: bump a patch version
#         if: contains(env.commitmsg, 'patch')
#         run: |
#           echo ::set-env name=version::$(npm version patch -m "[skip ci]")
#       - run: npm publish
#         env:
#           NODE_AUTH_TOKEN: ${{secrets.npm_token}}
